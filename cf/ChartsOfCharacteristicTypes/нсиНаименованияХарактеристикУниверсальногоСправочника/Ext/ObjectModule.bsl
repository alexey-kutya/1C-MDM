#Область ОбработчикиСобытий

Процедура ПередЗаписью(Отказ) 
	Если ОбменДанными.Загрузка Тогда 
		Возврат;
	КонецЕсли;
	
	// проверка существования наименования с таким же именем и типом
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Наименование", Наименование);
	Запрос.УстановитьПараметр("Ссылка", Ссылка);
	Запрос.УстановитьПараметр("ВидКлассификатора", ВидКлассификатора);
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	НаименованияХарактеристик.Ссылка
		|ИЗ
		|	ПланВидовХарактеристик.нсиНаименованияХарактеристикУниверсальногоСправочника КАК НаименованияХарактеристик
		|ГДЕ
		|	НаименованияХарактеристик.Наименование = &Наименование
		|	И НаименованияХарактеристик.ВидКлассификатора = &ВидКлассификатора
		|	И НЕ НаименованияХарактеристик.Ссылка = &Ссылка";        		
	ВыборкаДетальныеЗаписи = Запрос.Выполнить().Выбрать();  
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Если ВыборкаДетальныеЗаписи.Ссылка.ТипЗначения = ТипЗначения Тогда 
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Такое наименование, с таким типом уже определено");
			Отказ = Истина;
			Возврат;
		КонецЕсли;	
	КонецЦикла;
	
КонецПроцедуры

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	
	Если ТипЗначения.СодержитТип(Тип("СправочникСсылка.нсиУниверсальныйФункциональныйСправочник")) Тогда
		ПроверяемыеРеквизиты.Добавить("ВидСправочника");		
	КонецЕсли;

КонецПроцедуры

#КонецОбласти
